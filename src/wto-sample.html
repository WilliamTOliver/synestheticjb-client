<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="./../bower_components/iron-form/iron-form.html">
<link rel="import" href="./../bower_components/app-route/app-route.html">
<link rel="import" href="./../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="./../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="./../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="./../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="./../bower_components/paper-button/paper-button.html">
<link rel="import" href="./../bower_components/polymer/polymer-element.html">
<link rel="import" href="./shared-styles.html">

<dom-module id="wto-sample">
  <template>
    <style include="shared-styles">
       :host {
        display: block;

        padding: 10px;
      }

      .adminButton {
        width: 50px;
        height: 45px;
        background-color: steelblue;
        color: white;
        border-radius: 10px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      .spotifyButton {
        width: 50px;
        height: 45px;
        background-color: springgreen;
        color: black;
        border-radius: 10px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      .spotifyLogo {
        width: 30px;
        height: 30px;
      }

      .options-add {
        background-color: steelblue;
        color: white;
      }

      .dialLoc {
        position: relative;
      }

      .options-get {
        background-color: lightgrey !important;
        color: black;
      }
    </style>
    <iron-ajax id="initialAuthentication" handle-as="json" url="http://localhost:1337/auth/doAuth" on-response="_handleAuthResponse"></iron-ajax>
    <iron-ajax id="authRedirect" handle-as="json" on-response="_handleAuthCallback"></iron-ajax>

    <div class="card">

      <iron-form>
        <form method="get" action="/form/handler">
          <h2> Song Rating and Playlist Generation App </h2>
          <br>
          <strong> Admin </strong>
          <p> Add songs from spotify and create new playlist attributes and micro genres upon which users can create their playlists.
          </p>
          <a href="http://localhost:1337/auth/doauth?q=add">
            <paper-button class="adminButton" raised>
              <iron-icon icon="icons:build"></iron-icon>
            </paper-button>
          </a>
          <br>
          <br>
          <br>
          <strong> Playlist Generator </strong>
          <p> Create a playlist based on micor genres and admin added attributes.
          </p>
          <a href="http://localhost:1337/auth/doauth?q=playlist">
            <paper-button class="spotifyButton">
              <img class="spotifyLogo" src="../images/spotify.png">
            </paper-button>
          </a>
        </form>
      </iron-form>
    </div>
  </template>

  <script>
    class Sample extends Polymer.Element {
      static get is() { return 'wto-sample'; }

      static get properties() {
        return {
          token: {
            type: Object,
            value: function () {
              var loc = window.location.pathname;

            }
          },

          routeData: Object
        }
      }
      ready() {
        super.ready();
        // When possible, use afterNextRender to defer non-critical
        // work until after first paint.
        Polymer.RenderStatus.afterNextRender(this, function () {
          var a = window.location.pathname;
          console.log(a)
        });
      }
      _redirectPlaylist() {
        this.$.initialAuthentication.generateRequest();
      }
      _redirectAdd() {

      }

      _handleAuthResponse(e) {
        if (e) { console.log(e) }
        if (e.detail) { console.log(e.detail) }
        if (e.detail.response) { console.log(e.detail.response) }
        this.$.authRedirect.url = e.detail.response.url;
        this.$.authRedirect.headers = {
          "Access-Control-Allow-Origin": "*",
          "Access-Control-Allow-Headers": "Origin, X-Requested-With, Content-Type, Accept"
        }
        this.$.authRedirect.generateRequest()
      }
      _handleAuthCallback(e) {
        if (e) { console.log(e) }
        if (e.detail) { console.log(e.detail) }
        if (e.detail.response) { console.log(e.detail.response) }

      }



    }
    window.customElements.define(Sample.is, Sample);
  </script>
</dom-module>